var e,t;!function(e){e.createApp=e=>{const t=e.prototype.tag;window.customElements.define(t,e);const n=document.createElement(t);return{mount:e=>{const t=document.querySelector(e);t&&t.appendChild(n)}}},e.camelCase=e=>e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()}))}(e||(e={})),function(t){const n=[];t.clear=()=>{n.length=0},t.bindInput=(t,o,s,i,r)=>{t&&s&&i&&n.push({el:t,component:o,input:e.camelCase(s),output:r?i:e.camelCase(i),isStatic:!!r})},t.getInput=(e,t)=>n.find((n=>t===n.input&&e===n.el)),t.getOutput=e=>n.filter((t=>e===t.output))}(t||(t={}));const n=e=>t=>{t.prototype.__defineGetter__("tag",(()=>e.tag)),t.prototype.__defineGetter__("template",(()=>e.template)),t.prototype.__defineGetter__("components",(()=>e.components)),t.prototype.__defineGetter__("useShadow",(function(){return e.useShadow}))},o=()=>(e,n)=>{const o=`__${String(n)}`,s={get(){return this[o]},set(e){if(e=void 0===e?"undefined":e,this[o]!==e||e&&e.length>=0){this[o]=e;const s=t.getOutput(String(n));s&&s.forEach((t=>{t.el[`${t.input}`]=e})),this.requestRender()}},enumerable:!0,configurable:!0};Object.defineProperty(e,n,s)};var s,i;!function(e){const t={count:0,isEnabled:!0,message:"Custom message"};e.getters=()=>({getCount:()=>t.count,getState:()=>t,getMessage:()=>t.message}),e.actions=()=>({setCount:e=>{t.count=e},setEnabled:e=>{t.isEnabled=e},setMessage:e=>{t.message=e}})}(s||(s={})),function(t){const n=[];t.bind=(t,o,s,i)=>{t&&s&&i&&n.push({el:t,component:o,action:e.camelCase(s),callback:i})},t.emit=(t,o,s)=>{n.forEach((n=>{if(0===t.compareDocumentPosition(n.el)&&(o===n.action||e.camelCase(o)===n.action)&&"function"==typeof n.callback){n.callback.bind(n.component)(s)}}))}}(i||(i={}));class r{constructor(e,t,n,o){this.component=e,this.props=t,this.template=n,this.parentNode=o;const s=document.createElement("template");s.innerHTML=this.bindTemplate(n,t);const i=s.content.cloneNode(!0);this.parseVirtualModel(i,t),o.appendChild(i)}render(){const e=document.createElement("template");e.innerHTML=this.bindTemplate(this.template,this.props);const t=e.content.cloneNode(!0);this.updateVirtualModel(t,this.props),this.applyDiff(this.parentNode.children[0],t.children[0])}applyDiff(e,t){let n=Math.max(e.childNodes.length,t.childNodes.length),o=e;for(let s=0;s<n;s++){const n=t.childNodes[s];if(!n)continue;let i=e.childNodes[s];if(i){if(i.nodeType===Node.COMMENT_NODE&&n.nodeType!==Node.COMMENT_NODE){if(i.isEqualNode(r.comment)){const t=n.cloneNode(!0);e.replaceChild(t,i),i=t}}else if(n.nodeType!==Node.COMMENT_NODE&&!n.isEqualNode(i))if(n.nodeType===Node.ELEMENT_NODE&&i.nodeType!==Node.ELEMENT_NODE){const e=n.cloneNode(!0);this.insertAfter(e,o),i=e}else n.nodeType!==Node.ELEMENT_NODE&&i.nodeType===Node.ELEMENT_NODE&&(e.removeChild(i),s--)}else{const e=n.cloneNode(!0);this.insertAfter(e,o),i=e}if(n.nodeType===Node.ELEMENT_NODE)this.updateAttributes(i,n),this.applyDiff(i,n);else if(n.nodeType===Node.TEXT_NODE){let e=n.nodeValue;if(e){const t=e.trim();t&&i&&i.textContent!==t&&(i.textContent=t)}}else if(n.nodeType===Node.COMMENT_NODE&&i&&n.isEqualNode(r.comment)&&!i.isEqualNode(n)){const t=n.cloneNode(!0);e.replaceChild(t,i)}o=i}}updateAttributes(e,t){e.attributes&&Array.from(e.attributes).forEach((n=>{const o=t.getAttribute(n.name);o!=n.value&&e.setAttribute(n.name,o||"")}))}replaceAllParameter(e,t,n){const o=new RegExp(`{{(?:\\s+)?(${t})(?:\\s+)?}}`,"g");return e.replace(o,(()=>n))}evaluateTheCode(e,t){try{const n=[],o=[],s=/\s*([\w+\!\=\-\+\*\/\:\;\?\']+)\s*/g,i=e.match(s);if(i){i.forEach((e=>{const s=e.trim();-1!==t.indexOf(s)&&(n.push(`${s}`),o.push(this.component[s]))}));const s=new Function(n.toString(),`return ${e}`);return String(s(...o))}}catch(e){}}findJavascriptExpressions(e,t){return e=e.replace(/{{\s*([\w+\!\=\-\+\*\/\(\)\:\;\?\'\s*]+)\s*}}/g,((e,n)=>{let o=this.evaluateTheCode(n,t);return o||e}))}bindTemplate(e,t){return e=e.replace("\x3c!--:if--\x3e/g",""),t.forEach((t=>e=this.replaceAllParameter(e,t,this.component[t]))),e=this.findJavascriptExpressions(e,t)}parseVirtualModel(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];let s=o.nodeValue;s&&(s=s.trim());let i=!0;o.nodeType===Node.ELEMENT_NODE?o&&o.attributes&&(o.hasAttribute(":if")?i=this.isIfAllowRender(e,o):o.hasAttribute(":else")?this.isElseAllowRender(e,o,i):o.hasAttribute(":for")&&this.isForRender(o),this.bindInputParameters(o),this.parseAttributes(o,t),this.parseHandlers(o,!0)):o.nodeType===Node.TEXT_NODE&&s&&(o.nodeValue=s),o.nodeType===Node.ELEMENT_NODE&&this.parseVirtualModel(o,t)}}updateVirtualModel(e,t){let n=!0;for(let o=0;o<e.childNodes.length;o++){const s=e.childNodes[o];s.nodeType===Node.ELEMENT_NODE&&s&&s.attributes&&(s.hasAttribute(":if")?n=this.isIfAllowRender(e,s):s.hasAttribute(":else")?this.isElseAllowRender(e,s,n):s.hasAttribute(":for")&&this.isForRender(s),this.parseAttributes(s,t),this.parseHandlers(s,!1)),s.nodeType===Node.ELEMENT_NODE&&s.children.length>0&&this.updateVirtualModel(s,t)}}parseAttributes(e,t){Array.from(e.attributes).forEach((n=>{if(":"===n.name[0]){const o=n.name.substring(1);if("once"===o);else{let n="";if(e.hasAttribute(o)){const t=e.getAttribute(o);t&&(n=t)}const s=e.getAttribute(`:${o}`);s&&-1!==t.indexOf(s)?(n+=` ${this.component[s]}`,e.setAttribute(o,n.trim())):(n+=` ${s}`,e.setAttribute(o,n.trim()))}e.removeAttribute(`:${o}`)}}))}bindInputParameters(n){Array.from(n.attributes).forEach((o=>{if(":"===o.name[0]){const s=o.name.substring(1);if("class"!==s&&"style"!==s&&"id"!==s){const o=n.getAttribute(`:${s}`);if(o){const i=!(e.camelCase(o)in this.component);t.bindInput(n,this.component,s,o,i)}n.removeAttribute(`:${s}`)}}}))}parseHandlers(e,t){Array.from(e.attributes).forEach((n=>{if("@"===n.name[0]&&t){const t=e.getAttribute(`${n.name}`),o=n.name.substring(1),s=this.component[`${t}`];"function"==typeof s&&(i.bind(e,this.component,o,s),e.addEventListener(o,(()=>this.component[`${t}`]())))}"@"===n.name[0]&&e.removeAttribute(`${n.name}`)}))}isIfAllowRender(e,t){if(t&&t.attributes){const n=t.getAttribute(":if");if(t.removeAttribute(":if"),n){const o="!"===n[0]?!this.component[n.substring(1)]:this.component[n];if(!o){const n=r.comment.cloneNode(!0);e.replaceChild(n,t)}return o}}}isElseAllowRender(e,t,n){if(t&&t.attributes&&(t.removeAttribute(":else"),n)){const n=r.comment.cloneNode(!0);e.replaceChild(n,t)}}isForRender(e){const t=e.getAttribute(":for");e.removeAttribute(":for");const n=e.cloneNode(!0);if(t){const o=t.split(" ");let s=e;const i=this.component[o[2]];if(i){if(0===i.length||"undefined"===i)return void e.remove();const t=Object.getOwnPropertyNames(i),r=i.length?i.length:t.length;for(let i=0;i<r;i++){let r=this.component[o[2]][i];if(r||(r=this.component[o[2]][t[i]]),0==i){this.changeProperty(e,o[0],r);continue}const a=n.cloneNode(!0);this.changeProperty(a,o[0],r),this.insertAfter(a,s),s=a}}else e.remove()}}changeProperty(e,t,n){for(let o=0;o<e.childNodes.length;o++){const s=e.childNodes[o];let i=s.nodeValue;i&&(i=i.trim()),(s.nodeType===Node.ELEMENT_NODE&&0==s.children.length||s.nodeType===Node.TEXT_NODE&&i)&&this.updateTextContent(s,t,n),s.nodeType===Node.ELEMENT_NODE&&s.children.length>0&&this.changeProperty(s,t,n)}}updateTextContent(e,t,n){let o=e.textContent;if(o){o.replace(/{{/g,",").replace(/}}/g,",").split(",").forEach((e=>{const s=e.trim();if(s){let e=n;s.includes(".")?(s.split(".").forEach((t=>{e[t]&&(e=e[t])})),e="string"==typeof e?e:""):e=s===t?"string"==typeof n?n:JSON.stringify(n):"",o&&(o=this.replaceAllParameter(o,s,e))}})),e.textContent=o}}insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}}r.comment=document.createComment(":if");class a extends HTMLElement{constructor(){super(),this.store=s,this._props=[],this._engine=null,this._requestRender=0,this.onBeforeCreate(),this.isUseShadow()&&this.attachShadow({mode:"open"}),this._renderFunc=this.render.bind(this),this.created()}isUseShadow(){return this.useShadow}get tag(){return this.tag}get template(){return this.template}get components(){return this.components}get parent(){return this.isUseShadow()&&this.shadowRoot?this.shadowRoot:this}onBeforeCreate(){}created(){}beforeMount(){}onMounted(){}onUnmounted(){}beforeUnmount(){}onBeforeUpdate(){}onUpdated(){}connectedCallback(){this.registerComponents(),this.beforeMount(),this.parseProperties(this.template),this._engine=new r(this,this._props,this.template,this.parent),this.initializedInputParameters(),this.onMounted()}disconnectedCallback(){this.beforeUnmount(),this.onUnmounted()}attributeChangedCallback(e,t,n){}adoptedCallback(){}requestRender(){this._requestRender&&cancelAnimationFrame(this._requestRender),this._requestRender=requestAnimationFrame(this._renderFunc)}render(){this.onBeforeUpdate(),this._engine&&this._engine.render(),this.onUpdated()}emit(e,t){i.emit(this.parent,e,t)}registerComponents(){if(this.components&&this.components.length>0)for(let e in this.components){let t=this.components[e];t&&!window.customElements.get(`${this.components[e].prototype.tag}`)&&window.customElements.define(`${this.components[e].prototype.tag}`,t),t=window.customElements.get(`${this.components[e].prototype.tag}`),t.parentComponent=this}}parseProperties(e){Object.getOwnPropertyNames(this).forEach((e=>{if("_"===e[0]&&"_"===e[1]){const t=e.substring(2);t&&-1===this._props.indexOf(t)&&this._props.push(t)}}))}initializedInputParameters(){this._props.forEach((e=>{const n=t.getInput(this,e);if(n){const e=String(n.output);this[`${n.input}`]=n.isStatic?n.output:n.component[`${e}`]}}))}}const c=/:(\w+)/g,d=()=>{const e=[];let t=()=>{};const n={},o=()=>{const{hash:n}=window.location,o=e.find((e=>{const{testRegexp:t}=e;return t.test(n)}));if(!o)return void t();const s=((e,t)=>{const n={};if(0===e.params.length)return n;const o=t.match(e.testRegexp);return o&&(o.shift(),o.forEach(((t,o)=>{const s=e.params[o];n[s]=t}))),n})(o,window.location.hash);o.component(s)};return n.addRoute=(t,o)=>{const s=[],i=t.replace(c,((e,t)=>(s.push(t),"([^\\/]+)"))).replace(/\//g,"\\/");return e.push({testRegexp:new RegExp(`^${i}$`),component:o,params:s}),n},n.setNotFound=e=>(t=e,n),n.navigate=e=>{window.location.hash=e},n.start=()=>{window.addEventListener("hashchange",o),window.location.hash||(window.location.hash="#/"),o()},n};export{a as BaseComponent,n as Component,i as Emit,t as Input,o as Prop,e as WF,d as createRouter,s as useStore};
